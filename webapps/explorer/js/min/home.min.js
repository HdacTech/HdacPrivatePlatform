define(["jquery","handlebars","common"],function(c,b,a){var d=function(){var i=0;var m=true;var e=false;var l={ws_url:"ws://localhost:80/echo-ws",logout_url:"/member/logout.hdac",};
var h={sock:null,};var n={list:null,user:0,};this.initData=function(o){i=o.yPos;n=c.parseJSON(o.result);};this.getSavedData=function(){var o={};o.yPos=c(window).scrollTop();
o.result=JSON.stringify(n);return o;};this.init=function(){f(1,true,function(){j();m=false;});};this.resume=function(){j();};this.handleClick=function(v,u,x){var t=u.data();
var w=t.ui;if(w=="btnList"){c("#view_list").css("display","block");c("#view_info").css("display","none");c("#view_check").css("display","none");}else{if(w=="btnInfo"){c("#view_list").css("display","none");
c("#view_info").css("display","block");c("#view_check").css("display","none");}else{if(w=="btnCheck"){c("#view_list").css("display","none");c("#view_info").css("display","none");
c("#view_check").css("display","block");}}}var y=function(){var z={type:"post",dataType:"json",url:l.logout_url,cache:false,};c.ajax(z).done(function(B,A,D){if(B&&(B.success=="true")){var C=openDialog("Logout");
C.on("dialogclose",function(){var E="/home.hdac";a._COMMON_.MovePage(E,true);});}else{var C=openDialog("Logout Fail");}});};var r=function(z){z.parents(".ui-dialog").attr("tabindex",-1)[0].focus();
};var s=function(B){var A=function(C){if(!h.sock){h.sock=new WebSocket(l.ws_url);h.sock.onopen=function(){console.log("open");if(typeof C=="function"){C();
}};h.sock.onmessage=function(I){var H=function(L){if(L.message){return L.message;}return JSON.stringify(L);};var G=c.parseJSON(I.data);console.log(G);if(G.success==false){openDialog("Fail<br>"+H(G));
}else{switch(G.method){case a._METHOD_.GET_ADDRESS_TRANSACTION:var D=G.result;var F=c("tr[name=tx_tr]");if(F!=null){F.remove();}c.each(D,function(M,O){O=JSON.stringify(O);
var N=document.createElement("tr");var L=document.createElement("td");var P=document.createElement("td");c(N).attr("name","tx_tr");c(L).html("<b>"+M+"</b>");
c(P).html(O);N.appendChild(L);N.appendChild(P);c("#tx_tbody").append(N);});break;case a._METHOD_.SEND_RAW_TRANSACTION:var K="";c.each(G,function(M,N){var L=M+" : "+N+"<br>";
K+=L;});openDialog(K,"info");break;case a._METHOD_.GET_ADDRESS_BALANCES:if(G.result&&(G.result.length>0)){var D=G.result[0];openDialog("Balance : "+D.qty);
}break;case a._METHOD_.GET_BLOCKCHAIN_INFO:if(G.result){var D=G.result;var F=c("tr[name=info_tr]");if(F!=null){F.remove();}c.each(D,function(M,O){if(O==false){O="false";
}else{if(O==true){O=="true";}}var N=document.createElement("tr");var L=document.createElement("td");var P=document.createElement("td");c(N).attr("name","info_tr");
c(L).html("<b>"+M+"</b>");c(P).html(O);N.appendChild(L);N.appendChild(P);c("#info_tbody").append(N);});}break;case a._METHOD_.LIST_BLOCKS:if(G.result&&(G.result.length>0)){var D=G.result;
console.log(D);k(D);}break;case a._METHOD_.GET_BLOCK:if(G.result){var D=G.result;var E=c("[data-method="+G.method+"][data-hash="+D.hash+"]");if(E.length>0){var J=c("#detail_info").dialog({title:"test",width:700,height:400,});
r(J);c("#detail_bits").html(D.bits);c("#detail_chainwork").html(D.chainwork);c("#detail_difficulty").html(D.difficulty);c("#detail_miner").html(D.miner);
c("#detail_size").html(D.size);c("#detail_tx").html("");c.each(D.tx,function(N,M){var L=document.createElement("a");c(L).attr("href","javascript:;");c(L).attr("data-name","hdac");
c(L).attr("data-click","Y");c(L).attr("data-method",a._METHOD_.GET_TXOUT);c(L).attr("data-tx",M);c(L).css("color","blue");c(L).html(M);c("#detail_tx").append(L).append("<br>");
});}}break;case a._METHOD_.GET_TXOUT:openDialog("Address : "+JSON.stringify(G.result.scriptPubKey.addresses));break;default:openDialog(H(G));break;}}e=false;
};h.sock.onclose=function(){console.log("close");h.sock=null;};}};if(e){return;}var z=JSON.stringify(B);if(h.sock){e=true;h.sock.send(z);}else{A(function(){e=true;
h.sock.send(z);});}};var o=function(B,z){var A={method:B,};switch(B){case a._METHOD_.LIST_UNSPENT:A.amount=c("[name=amount]").val();A.to=c("[name=to]").val();
A.textdata=c("[name=textdata]").val();if(n.user>-1){if(A.to==""){openDialog("Select a destination to send.");return;}s(A);}else{openDialog("You can use it after login.");
}break;case a._METHOD_.GET_ADDRESS_BALANCES:if(n.user>-1){s(A);}else{openDialog("You can use it after login.");}break;case a._METHOD_.GET_BLOCKCHAIN_INFO:case a._METHOD_.LIST_BLOCKS:s(A);
break;case a._METHOD_.GET_BLOCK:A.hash=z.hash;s(A);break;case a._METHOD_.GET_TXOUT:A.tx=z.tx;s(A);break;case a._METHOD_.GET_ADDRESS_TRANSACTION:A.txid=c("[name=txid]").val();
if(n.user>-1){if(A.txid==""){openDialog("Please enter txid");return;}s(A);}else{openDialog("You can use it after login.");}break;}};var t=u.data(),q=t.name;
switch(q){case"login":var p="/member/login.hdac";a._COMMON_.MovePage(p,true);break;case"logout":y();break;case"join":var p="/member/create.hdac";a._COMMON_.MovePage(p,true);
break;case"hdac":o(t.method,t);break;default:if(typeof x=="function"){x(v,u);}break;}};this.getYpos=function(){return i;};this.getInit=function(){return m;
};var f=function(q,p,o){var r=c.parseJSON(c("[name=data]").val());n.list=r.list;n.user=r.user;if(typeof o=="function"){o();}};var j=function(){g();};var k=function(q){var o=function(t){var s=Math.ceil((new Date()-new Date(t*1000))/1000);
if(s<60){return s+" seconds ago";}s=Math.ceil(s/60);if(s<60){return s+" minutes ago";}s=Math.ceil(s/60);if(s<24){return s+" hours ago";}s=Math.ceil(s/24);
return s+" days ago";};var p=c("tr[name=list_tr]");if(p!=null){p.remove();}var r=q.reverse();c.each(r,function(v,z){var x=document.createElement("tr");
var s=document.createElement("td");var y=document.createElement("td");var w=document.createElement("td");var t=document.createElement("td");var u=document.createElement("a");
c(x).attr("name","list_tr");c(u).attr("href","javascript:;");c(u).attr("data-click","Y");c(u).attr("data-name","hdac");c(u).attr("data-method",a._METHOD_.GET_BLOCK);
c(u).attr("data-hash",z.hash);c(u).html(z.hash);s.appendChild(u);c(y).html(z.height);c(w).html(o(z.time));c(t).html(z.txcount);x.appendChild(s);x.appendChild(y);
x.appendChild(w);x.appendChild(t);c("#list_tbody").append(x);});};var g=function(){c("#btn_send").attr("data-method",a._METHOD_.LIST_UNSPENT);c("#btn_list").attr("data-method",a._METHOD_.LIST_BLOCKS);
c("#btn_info").attr("data-method",a._METHOD_.GET_BLOCKCHAIN_INFO);c("#btn_bal").attr("data-method",a._METHOD_.GET_ADDRESS_BALANCES);c("#btn_txcheck").attr("data-method",a._METHOD_.GET_ADDRESS_TRANSACTION);
c("#header_title").css("display","block");c("#header_inputarea").css("display","block");c("#view_body").css("display","block");c("#btn_list").click();var p="";
if(n.user>-1){c("#btn_login").html("<b>Logout<b>");c("#btn_login").attr("data-name","logout");var o;c.each(n.list,function(r,q){p+='<option value="'+q.user_no+'">'+q.username+"</option>";
if(n.user==q.user_no){o=q.user_id;}});c("#select_user").append(p);c("#btn_join").html("current user = "+o);}else{}};};return new d();});