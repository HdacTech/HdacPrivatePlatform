define(["jquery","handlebars","common"],function(c,b,a){var d=function(){var i=0;var q=true;var e=false;var o={ws_url:"ws://192.168.70.83:80/echo-ws",logout_url:"/member/logout.hdac",};
var h={sock:null,template:null,};var r={list:null,user:0,};this.initData=function(s){i=s.yPos;r=c.parseJSON(s.result);};this.getSavedData=function(){var s={};
s.yPos=c(window).scrollTop();s.result=JSON.stringify(r);return s;};this.init=function(){g(1,true,function(){k();q=false;});};this.resume=function(){k();
};this.handleClick=function(z,y,B){var x=y.data();var C=function(){var D={type:"post",dataType:"json",url:o.logout_url,cache:false,};c.ajax(D).done(function(F,E,G){if(F&&(F.success=="true")){p(null,"logout",function(){var H="/home.hdac";
a._COMMON_.MovePage(H,true);});}else{p("Fail","logout failed");}});};var v=function(F){var E=function(G){if(!h.sock){h.sock=new WebSocket(o.ws_url);h.sock.onopen=function(){console.log("open");
if(typeof G=="function"){G();}};h.sock.onmessage=function(M){var L=function(N){if(N.message){return N.message;}return JSON.stringify(N);};var K=c.parseJSON(M.data);
console.log(K);if(K.success==false){try{if(K.message){var I=c.parseJSON(K.message);p("Fail",I.message);}}catch(M){console.log(M);}}else{switch(K.method){case a._METHOD_.GET_ADDRESS_TRANSACTION:var H=K.result;
var J=c("tr[name=tx_tr]");if(J!=null){J.remove();}c.each(H,function(O,Q){Q=JSON.stringify(Q);var P=document.createElement("tr");var N=document.createElement("td");
var R=document.createElement("td");c(P).attr("name","tx_tr");c(N).html("<b>"+O+"</b>");c(R).html(Q);P.appendChild(N);P.appendChild(R);c("#tx_tbody").append(P);
});break;case a._METHOD_.SEND_RAW_TRANSACTION:console.log(K);break;case a._METHOD_.GET_ADDRESS_BALANCES:if(K.result&&(K.result.length>0)){p(null,"Balance : "+K.result[0].qty);
}break;case a._METHOD_.GET_BLOCKCHAIN_INFO:f(K);break;case a._METHOD_.LIST_BLOCKS:m(K);break;case a._METHOD_.GET_BLOCK:l(K);break;case a._METHOD_.GET_TXOUT:console.log(K.result);
if(K.result&&K.result.scriptPubKey){p("Address",JSON.stringify(K.result.scriptPubKey.addresses));}break;default:p(null,L(K));break;}}e=false;};h.sock.onclose=function(){console.log("close");
h.sock=null;};}};if(e){return;}var D=JSON.stringify(F);console.log(D);if(h.sock){e=true;h.sock.send(D);}else{E(function(){e=true;h.sock.send(D);});}};var w=function(D){if(r.user.userNo>-1){v(D);
}else{p(null,"You can use it after login.");}};var A=function(D){console.log(D);if(r.user.userNo>-1){if(D.txid==""){p(null,"Please enter txid.");return;
}v(D);}else{p(null,"You can use it after login.");}};var s=function(F,D){var E={method:F,};switch(F){case a._METHOD_.LIST_UNSPENT:E.amount=c("[name=amount]").val();
E.to=c("[name=to]").val();E.textdata=c("[name=textdata]").val();if(r.user.userNo>-1){if(E.to==""){p(null,"Select a destination to send.");return;}v(E);
}else{p(null,"You can use it after login.");}break;case a._METHOD_.GET_ADDRESS_BALANCES:w(E);break;case a._METHOD_.GET_BLOCKCHAIN_INFO:case a._METHOD_.LIST_BLOCKS:v(E);
break;case a._METHOD_.GET_BLOCK:E.hash=D.hash;v(E);break;case a._METHOD_.GET_TXOUT:E.tx=D.tx;v(E);break;case a._METHOD_.GET_ADDRESS_TRANSACTION:E.txid=c("[name=txid]").val();
A(E);break;}};var x=y.data(),u=x.name;switch(u){case"login":var t="/member/login.hdac";a._COMMON_.MovePage(t,true);break;case"logout":C();break;case"join":var t="/member/create.hdac";
a._COMMON_.MovePage(t,true);break;case"hdac":s(x.method,x);break;case"tx_check":n();break;default:if(typeof B=="function"){B(z,y);}break;}};this.getYpos=function(){return i;
};this.getInit=function(){return q;};var g=function(u,t,s){var v=c.parseJSON(c("[name=data]").val());r.list=v.list;r.user=v.user;if(typeof s=="function"){s();
}};var k=function(){var s=function(){b.registerHelper("chk",function(u,t){if(u>-1){return t.fn(this);}return t.inverse(this);});b.registerHelper("toGMT",function(u){var t=Math.ceil((new Date()-new Date(u*1000))/1000);
if(t<60){return t+" seconds ago";}t=Math.ceil(t/60);if(t<60){return t+" minutes ago";}t=Math.ceil(t/60);if(t<24){return t+" hours ago";}t=Math.ceil(t/24);
return t+" days ago";});};s();j();c(".ui.dropdown").dropdown();};var j=function(){var t=function(){var v=b.compile(c("#header-menu").html());c("#menu").html(v(r.user));
};var s=function(){r.method=a._METHOD_.LIST_UNSPENT;if(r.user.userNo>-1){var v=b.compile(c("#header_form").html());c("#form").html(v(r)).show();}};var u=function(){var v=b.compile(c("#body_header").html());
c("#main_header").html(v(a._METHOD_));};t();s();u();console.log(r);};var m=function(t){if(t.result&&(t.result.length>0)){t.result.method=a._METHOD_.GET_BLOCK;
var s=b.compile(c("#block_list").html());c("#main_body").html(s(t.result));}};var f=function(t){if(t.result){var s=b.compile(c("#block_info").html());c("#main_body").html(s(t.result));
}};var l=function(v){if(v.result){var s=v.result;c("#block_detail_table").remove();var u=c("[data-method="+v.method+"][data-hash="+s.hash+"]");if(u.length>0){v.result.method=a._METHOD_.GET_TXOUT;
var t=b.compile(c("#block_detail").html());u.append(t(v.result));}}};var n=function(){var s=b.compile(c("#tx_check_form").html());c("#main_body").html(s(a._METHOD_));
};var p=function(v,u,s){var t={header:v,content:u,};if(h.template==null){h.template=b.compile(c("#modal_popup").html());}c("#modal").html(h.template(t));
c("#ui_modal").modal({onHide:function(){if(typeof s=="function"){s();}}}).modal("show");};};return new d();});