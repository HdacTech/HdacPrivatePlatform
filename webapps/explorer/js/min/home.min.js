define(["jquery","handlebars","common"],function(c,b,a){var d=function(){var i=0;var s=true;var e=false;var q={ws_url:"ws://localhost:80/echo-ws",logout_url:"/member/logout.hdac",};
var h={sock:null,template:null,};var t={list:null,user:0,};this.initData=function(u){i=u.yPos;t=c.parseJSON(u.result);};this.getSavedData=function(){var u={};
u.yPos=c(window).scrollTop();u.result=JSON.stringify(t);return u;};this.init=function(){g(1,true,function(){k();s=false;});};this.resume=function(){k();
};this.handleClick=function(B,A,D){var z=A.data();var E=function(){var F={type:"post",dataType:"json",url:q.logout_url,cache:false,};c.ajax(F).done(function(H,G,I){if(H&&(H.success=="true")){r(null,"logout",function(){var J="/home.hdac";
a._COMMON_.MovePage(J,true);});}else{r("Fail","logout failed");}});};var x=function(H){var G=function(I){if(!h.sock){h.sock=new WebSocket(q.ws_url);h.sock.onopen=function(){console.log("open");
if(typeof I=="function"){I();}};h.sock.onmessage=function(M){var L=function(N){if(N.message){return N.message;}return JSON.stringify(N);};var K=c.parseJSON(M.data);
console.log(K);if(K.success==false){if(K.message){console.log(typeof K.message);try{var J=c.parseJSON(K.message);r("Fail",J.message);}catch(M){console.log(M);
r("Fail",K.message);}}}else{switch(K.method){case a._METHOD_.GET_RAW_TRANSACTION:if(K.result&&(K.result.length>0)){r(null,"Tx : "+K.result);}break;case a._METHOD_.SEND_RAW_TRANSACTION:console.log(K);
break;case a._METHOD_.GET_ADDRESS_BALANCES:if(K.result&&(K.result.length>0)){r(null,"Balance : "+K.result[0].qty);}break;case a._METHOD_.GET_BLOCKCHAIN_INFO:f(K);
break;case a._METHOD_.LIST_BLOCKS:n(K);break;case a._METHOD_.GET_BLOCK:l(K);break;case a._METHOD_.GET_TXOUT:console.log(K.result);if(K.result&&K.result.scriptPubKey){r("Address",JSON.stringify(K.result.scriptPubKey.addresses));
}break;default:r(null,L(K));break;}}e=false;};h.sock.onclose=function(){console.log("close");h.sock=null;};}};if(e){return;}var F=JSON.stringify(H);console.log(F);
if(h.sock){e=true;h.sock.send(F);}else{G(function(){e=true;h.sock.send(F);});}};var y=function(F){if(t.user.userNo>-1){x(F);}else{r(null,"You can use it after login.");
}};var C=function(F){console.log(F);if(F.tx==""){r(null,"Please enter txid.");return;}x(F);};var u=function(H,F){var G={method:H,};switch(H){case a._METHOD_.LIST_UNSPENT:G.amount=c("[name=amount]").val();
G.to=c("[name=to]").val();G.textdata=c("[name=textarea]").val();if(t.user.userNo>-1){if(G.to==""){r(null,"Select a destination to send.");return;}x(G);
}else{r(null,"You can use it after login.");}break;case a._METHOD_.GET_ADDRESS_BALANCES:y(G);break;case a._METHOD_.GET_BLOCKCHAIN_INFO:case a._METHOD_.LIST_BLOCKS:x(G);
break;case a._METHOD_.GET_BLOCK:G.hash=F.hash;x(G);break;case a._METHOD_.GET_TXOUT:G.tx=F.tx;x(G);break;case a._METHOD_.GET_RAW_TRANSACTION:G.method=a._METHOD_.GET_TXOUT;
G.tx=c("[name=txid]").val();C(G);break;}};var z=A.data(),w=z.name;switch(w){case"login":var v="/member/login.hdac";a._COMMON_.MovePage(v,true);break;case"logout":E();
break;case"join":var v="/member/create.hdac";a._COMMON_.MovePage(v,true);break;case"hdac":u(z.method,z);break;case"tx_check":o();break;case"copy":m(z);
break;default:if(typeof D=="function"){D(B,A);}break;}};this.getYpos=function(){return i;};this.getInit=function(){return s;};var p=function(){if(window.navigator.userAgent.toLowerCase().indexOf("chrome")==-1){return true;
}return false;};var m=function(u){if(p()){window.clipboardData.setData("Text",u.tx);alert("Copy Success");return;}window.prompt("Copy the text below using Ctrl+c",u.tx);
};var g=function(w,v,u){var x=c.parseJSON(c("[name=data]").val());t.list=x.list;t.user=x.user;if(typeof u=="function"){u();}};var k=function(){var u=function(){b.registerHelper("chk",function(w,v){if(w>-1){return v.fn(this);
}return v.inverse(this);});b.registerHelper("toGMT",function(w){var v=Math.ceil((new Date()-new Date(w*1000))/1000);if(v<60){return v+" seconds ago";}v=Math.ceil(v/60);
if(v<60){return v+" minutes ago";}v=Math.ceil(v/60);if(v<24){return v+" hours ago";}v=Math.ceil(v/24);return v+" days ago";});};u();j();c(".ui.dropdown").dropdown();
};var j=function(){var v=function(){var x=b.compile(c("#header-menu").html());c("#menu").html(x(t.user));};var u=function(){t.method=a._METHOD_.LIST_UNSPENT;
if(t.user.userNo>-1){var x=b.compile(c("#header_form").html());c("#form").html(x(t)).show();}};var w=function(){var x=b.compile(c("#body_header").html());
c("#main_header").html(x(a._METHOD_));};v();u();w();console.log(t);};var n=function(v){if(v.result&&(v.result.length>0)){v.result.method=a._METHOD_.GET_BLOCK;
var u=b.compile(c("#block_list").html());c("#main_body").html(u(v.result));}};var f=function(v){if(v.result){var u=b.compile(c("#block_info").html());c("#main_body").html(u(v.result));
}};var l=function(x){if(x.result){var u=x.result;c("#block_detail_table").remove();var w=c("[data-method="+x.method+"][data-hash="+u.hash+"]");if(w.length>0){x.result.method=a._METHOD_.GET_TXOUT;
var v=b.compile(c("#block_detail").html());w.after(v(x.result));}}};var o=function(){var u=b.compile(c("#tx_check_form").html());c("#main_body").html(u(a._METHOD_));
};var r=function(x,w,u){var v={header:x,content:w,};if(h.template==null){h.template=b.compile(c("#modal_popup").html());}c("#modal").html(h.template(v));
c("#ui_modal").modal({onHide:function(){if(typeof u=="function"){u();}}}).modal("show");};};return new d();});